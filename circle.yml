machine:
  timezone:
    Europe/Warsaw
  hosts:
    local.z.pl: 127.0.0.1
  services:
    - memcached
    - mongodb
    - elasticsearch
    - beanstalkd

dependencies:
  pre:
    - sudo apt-get remove apache2*; sudo apt-get autoremove
    - sudo apt-get -y purge php.*
    - sudo add-apt-repository ppa:rquillo/ansible -y; sudo apt-get update; sudo apt-get install -y ansible
    - ansible-playbook ./ansible/site.yml
    - mysql -u ubuntu -e "CREATE DATABASE zl_general_en_test"
    - mysql -u ubuntu -e "CREATE DATABASE zl_general_pl_test"
    - mysql -u ubuntu -e "CREATE DATABASE zl_stats_en_test"
    - mysql -u ubuntu -e "CREATE DATABASE zl_stats_pl_test"
    - mysql -u ubuntu -e "CREATE DATABASE zl_central_test"
    - mysql -u ubuntu -e "CREATE DATABASE geoapi_en"
    - mysql -u ubuntu -e "CREATE DATABASE geoapi_pl"
    - composer config --global github-oauth.github.com $GITHUB_TOKEN
    - composer --version
    - composer install --prefer-source --no-interaction --optimize-autoloader
#  post:
#    Bootstrap application
#    - php bin/phing -Dbuild.confirm=Y bootstrap

test:
  pre:
    - php ./test.php
  override:
    - php -v