machine:
  timezone:
    Europe/Warsaw
  hosts:
    local.z.pl: 127.0.0.1
  services:
    - memcached
    - mongodb
    - elasticsearch

dependencies:
  pre:
    - sudo apt-get remove apache2*; sudo apt-get autoremove
    - sudo apt-get -y purge php.*
    - sudo add-apt-repository ppa:rquillo/ansible -y; sudo apt-get update; sudo apt-get install -y ansible
    - ansible-playbook ./ansible/site.yml
    - mysql -u ubuntu -e "CREATE DATABASE zl_general_en_test"
    - mysql -u ubuntu -e "CREATE DATABASE zl_general_pl_test"
    - mysql -u ubuntu -e "CREATE DATABASE zl_stats_en_test"
    - mysql -u ubuntu -e "CREATE DATABASE zl_stats_pl_test"
    - mysql -u ubuntu -e "CREATE DATABASE zl_central_test"
    - mysql -u ubuntu -e "CREATE DATABASE geoapi_en"
    - mysql -u ubuntu -e "CREATE DATABASE geoapi_pl"
  post:
    - composer config --global github-oauth.github.com $GITHUB_TOKEN
    - composer --version
    - composer install
# database:
#  override:
#    - mysql -u ubuntu symfony2_standard_template < src/craft/storage/backups/craft.sql


test:
  pre:
    - php ./test.php
  override:
    - php -v

# Deploying your code to your web servers
# https://circleci.com/docs/configuration#deployment
# deployment:
#   production:
#     branch: master
#     commands:
#       - git config --global user.email "team@newism.com.au"
#       - git config --global user.name "newism-newbot"
#       - git add ./dist -A
#       - git commit -m "Build by Newbot via CircleCI"
#       - git push origin master
#       - cap production deploy